app.factory("group",["$firebaseObject","$routeParams","$interval","$location",function(e,n,t,o){var r=this,i=n.id||null,a="https://centerofus.firebaseio.com/groups/",u=new Firebase(a),s=e(u),l=null,m=null,c=!1,f=function(){console.log("Ready Function not specified yet")};r.members=[],r.ready=function(e){return e&&(f=e),c},s.$loaded().then(function(){c=!0,i&&i in s&&(l=s[i],r.members=l.members),f()});var p=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n="",t=0;8>t;t++)n+=e[Math.floor(Math.random()*e.length)];return n};return r.createGroup=function(e,n,t,o){if(!c)return null;for(var i=p();i in s;)i=p();s[i]={timestamp:(new Date).getTime(),members:{},name:n||"Group "+i,options:{radius:5,types:{}}},s[i].members[e.name]={lat:e.lat,lng:e.lng,online:!0,creator:!0,alias:e.name};for(var a=0;a<t.length;a++)s[i].options.types[t[a]]=1;return s.$save().then(function(){l=s[i],r.members=l.members,o&&o(i)}),i},r.updateVotes=function(e,n){s[i].options.types[e]+=n?1:-1,s.$save().then(function(){})},r.joinGroup=function(e,n){return c?i in s?(l=s[i],l.members[e.name]={lat:e.lat,lng:e.lng,creator:l.members[e.name]?l.members[e.name].creator:!1,online:!0,alias:e.name},s.$save().then(function(){n&&n()}),!0):!1:null},r.online=function(e){i=n.id||null,i&&i in s?(m=new Firebase(a+i+"/members/"+e+"/online"),m.onDisconnect().set(Firebase.ServerValue.TIMESTAMP),m.on("value",function(e){e!==!0&&i&&m.set(!0)}),m.set(!0)):o.path("/")},r.toggleIgnore=function(e){l[e].ignore=!l[e].ignore},r.leaveGroup=function(e,n){return c?(l&&delete l.members[e],void s.$save().then(function(){n&&n()})):null},r.onUpdate=function(t){if(i=n.id||null){var o=0,u=new Firebase(a+i),s=e(u);s.$watch(function(){l&&(l=s,r.name=l.name,r.members=l.members,r.options=l.options,clearTimeout(o),o=setTimeout(t,500))})}},r.id=function(){return i},t(function(){i=n.id||null},50),r}]);