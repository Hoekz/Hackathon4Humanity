app.factory("group",["$firebaseObject","$routeParams","$interval","$location",function(e,n,t,o){var r=this,i=n.id||null,a="https://centerofus.firebaseio.com/groups/",u=new Firebase(a),s=e(u),m=null,l=null,c=!1,f=function(){console.log("Ready Function not specified yet")};r.members=[],r.ready=function(e){return e&&(f=e),c},s.$loaded().then(function(){c=!0,i&&i in s&&(m=s[i],r.members=m.members),f()});var b=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n="",t=0;8>t;t++)n+=e[Math.floor(Math.random()*e.length)];return n};return r.createGroup=function(e,n,t,o){if(!c)return null;for(var i=b();i in s;)i=b();s[i]={timestamp:(new Date).getTime(),members:{},name:n||"Group "+i,options:{radius:5,types:{}}},s[i].members[e.name]={lat:e.lat,lng:e.lng,online:!0,creator:!0,ignore:!1};for(var a=0;a<t.length;a++)s[i].options.types[t[a]]=1;return s.$save().then(function(){m=s[i],r.members=m.members,o&&o(i)}),i},r.updateVotes=function(e,n){s[i].options.types[e]+=n?1:-1,s.$save().then(function(){})},r.joinGroup=function(e,t){return i=n.id,c&&i in s?(m=s[i],m.members[e.name]={lat:e.lat,lng:e.lng,creator:m.members[e.name]?m.members[e.name].creator:!1,online:!0,ignore:!1},s.$save().then(function(){t&&t()}),!0):!1},r.online=function(e){i=n.id||null,i&&i in s?(l=new Firebase(a+i+"/members/"+e+"/online"),l.onDisconnect().set(Firebase.ServerValue.TIMESTAMP),l.on("value",function(e){e!==!0&&i&&l.set(!0)}),l.set(!0)):o.path("/")},r.toggleIgnore=function(e){m.members[e].ignore=!m.members[e].ignore,m.$save()},r.leaveGroup=function(e,n){return c?(m&&delete m.members[e],void s.$save().then(function(){n&&n()})):null},r.onUpdate=function(t){if(i=n.id||null){var o=0,u=new Firebase(a+i),s=e(u);s.$watch(function(){m&&(m=s,r.name=m.name,r.members=m.members,r.options=m.options,clearTimeout(o),o=setTimeout(t,500))})}},r.id=function(){return i},t(function(){i=n.id||null},50),r}]);