app.factory("group",["$firebaseObject","$routeParams","$interval","$location",function(e,n,o,t){var r=this,i=n.id||null,a="https://centerofus.firebaseio.com/groups/",m=new Firebase(a),s=e(m),l=null,u=null,c=!1,f=!1,b=function(){console.log("Ready Function not specified yet")};r.members=[],r.ready=function(e){return e&&(b=e),c},s.$loaded().then(function(){c=!0,i&&i in s&&(l=s[i],r.members=l.members),b()});var p=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n="",o=0;8>o;o++)n+=e[Math.floor(Math.random()*e.length)];return n};return r.createGroup=function(e,n,o,t){if(!c)return null;for(var i=p();i in s;)i=p();s[i]={timestamp:(new Date).getTime(),members:{},name:n||"Group "+i,options:{radius:5,types:{}}},s[i].members[e.name]={lat:e.lat,lng:e.lng,online:!0,creator:!0,ignore:!1};for(var a=0;a<o.length;a++)s[i].options.types[o[a]]=1;return s.$save().then(function(){l=s[i],r.members=l.members,t&&t(i)}),i},r.updateVotes=function(e,n){s[i].options.types[e]+=n?1:-1,s.$save()},r.joinGroup=function(e,o){return i=n.id,c&&i in s?(l=s[i],!l.members[e.name]&&f?!1:(l.members[e.name]={lat:e.lat,lng:e.lng,creator:l.members[e.name]?l.members[e.name].creator:!1,online:!0,ignore:l.members[e.name]?l.members[e.name].ignore:!1},s.$save().then(function(){o&&o()}),!0)):!1},r.online=function(e){i=n.id||null,i&&i in s?(u=new Firebase(a+i+"/members/"+e+"/online"),u.onDisconnect().set(Firebase.ServerValue.TIMESTAMP),u.on("value",function(e){e!==!0&&i&&u.set(!0)}),u.set(!0)):t.path("/")},r.toggleIgnore=function(e){l.members[e].ignore=!l.members[e].ignore,l.$save()},r.updateRadius=function(e){s[i].options.radius=e,s.$save()},r.leaveGroup=function(e,n){return c?(l&&delete l.members[e],void s.$save().then(function(){n&&n()})):null},r.onUpdate=function(o){if(i=n.id||null){var t=0,m=new Firebase(a+i),s=e(m);s.$watch(function(){l&&(l=s,r.closed=l.closed,r.name=l.name,r.members=l.members,r.options=l.options,r.location=l.location,r.timestamp=l.timestamp,f=!!l.location,clearTimeout(t),t=setTimeout(o,500))})}},r.finalized=function(){return f},r.id=function(){return i},r.finalLocation=function(e){console.log(e),s[i].location={lat:e.geometry.location.H,lng:e.geometry.location.L,name:e.name},s[i].closed=!0,s.$save()},o(function(){i=n.id||null},50),r}]);